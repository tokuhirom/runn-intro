desc: 動的なテストデータ生成
runners:
  httpbin: http://localhost:8080

vars:
  num_users: 3
  departments:
    - "IT"
    - "Sales"
    - "Marketing"
    - "HR"

steps:
  # Faker関数を使ったデータ生成とPOST
  - desc: ユーザーデータの生成と送信
    loop:
      count: 3
    httpbin:
      /post:
        post:
          body:
            application/json:
              id: "{{ i + 1 }}"
              name: "{{ faker.Name() }}"
              email: "{{ faker.Email() }}"
              phone: "{{ faker.Numerify('###-###-####') }}"
              department: "{{ vars.departments[i % len(vars.departments)] }}"
              timestamp: "{{ i + 1000 }}"
    test: |
      current.res.status == 200 &&
      current.res.body.json.id == i + 1

  # 生成されたデータの検証
  - desc: データ生成の確認
    httpbin:
      /anything:
        get:
          query:
            total_created: "{{ vars.num_users }}"
          body:
    test: current.res.status == 200
    dump: |
      {
        "total_users": vars.num_users,
        "departments_used": vars.departments
      }