desc: 条件付きループ（リトライ機能）
runners:
  httpbin: http://localhost:8080

vars:
  max_retries: 3

steps:
  # 成功するまでリトライ（HTTPBinの/status/200を使用）
  - desc: 成功するまでリトライ
    loop:
      count: 3
      until: current.res.status == 200
      minInterval: 1s
      maxInterval: 2s
    httpbin:
      /status/200:
        get:
          body:
    test: current.res.status == 200

  # ランダムなステータスコードでのリトライ
  - desc: ランダムステータスでのリトライ
    loop:
      count: 5
      until: current.res.status == 200
      minInterval: 500ms
      maxInterval: 1s
    httpbin:
      /status/200,400,500:  # 200, 400, 500のいずれかを返す
        get:
          body:
    test: |
      current.res.status == 200 || i == 4  # 成功するか最後の試行

  # JSONレスポンスの条件でリトライ
  - desc: JSONレスポンス条件でのリトライ
    loop:
      count: 3
      until: |
        current.res.status == 200 &&
        current.res.body.json != null
    httpbin:
      /json:
        get:
          body:
    test: |
      current.res.status == 200 &&
      current.res.body.slideshow != null