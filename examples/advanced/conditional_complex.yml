desc: 複雑な条件式
runners:
  httpbin: http://localhost:8080

vars:
  user_role: "admin"
  user_permissions:
    - read
    - write
    - delete
  api_version: 2
  test_data:
    - id: 1
      name: "Test Data 1"
    - id: 2
      name: "Test Data 2"

steps:
  # 複数条件の組み合わせ
  - desc: ロールと権限のチェック
    if: |
      vars.user_role == "admin" &&
      len(vars.test_data) > 0
    httpbin:
      /post:
        post:
          body:
            application/json:
              role: "{{ vars.user_role }}"
              data_count: "{{ len(vars.test_data) }}"
    test: current.res.status == 200

  # 配列の条件チェック
  - desc: 権限チェック
    if: |
      vars.api_version >= 2 &&
      ("write" in vars.user_permissions || vars.user_role == "admin")
    httpbin:
      /anything:
        post:
          body:
            application/json:
              action: "write"
              permissions: "{{ vars.user_permissions }}"
    test: |
      current.res.status == 200 &&
      current.res.body.json.action == "write"

  # 複雑な論理式
  - desc: 複合条件のテスト
    if: |
      (len(vars.test_data) >= 2 || vars.user_role == "admin") &&
      vars.api_version > 1 &&
      "delete" in vars.user_permissions
    httpbin:
      /delete:
        delete:
          body:
            application/json:
              authorized: true
    test: current.res.status == 200