desc: エラーハンドリングと条件分岐
runners:
  httpbin: http://localhost:8080

steps:
  # エラー時の代替処理（404を意図的に発生させる）
  - desc: プライマリリクエスト（失敗する）
    httpbin:
      /status/404:
        get:
          body:
    test: true  # エラーでも続行

  - desc: フォールバックリクエスト
    if: steps[0].res.status != 200
    httpbin:
      /status/200:
        get:
          body:
    test: current.res.status == 200

  # 成功時の追加処理
  - desc: 結果の処理
    if: |
      steps[0].res.status == 200 ||
      (steps[1].res != null && steps[1].res.status == 200)
    httpbin:
      /post:
        post:
          body:
            application/json:
              source: |
                steps[0].res.status == 200 ? "primary" : "fallback"
              primary_status: "{{ steps[0].res.status }}"
              success: true
    test: current.res.status == 200